<!DOCTYPE html>
<html class="no-js">
<head>
	<title>Cathay Pacific Tablet</title>
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
	<div id="qzad" class="preload">
		<div class="frames f1 noflicker" id="f1">
			<div class="tagline"><img src="img/f1-tagline.png" alt="" width="390" class="noflicker"/></div>
			<div class="logo"><img src="img/logo.png" alt="Cathay Pacific logo" class="noflicker"/></div>
		</div>
		<div class="frames f2 hide noflicker" id="f2">
			<div class="row upper"></div>
			<div class="row bottom"></div>
		</div>
		<div class="frames f3 hide noflicker" id="f3">
		</div>
		<div class="frames f4 hide noflicker" id="f4">
			<div class="tagline"><img src="img/f1-tagline.png" alt="People. They make an airline." width="392" class="noflicker"/></div>
			<div class="vid-container">
				<div class="vid-large link"><a href="#" class="ixtrack"  data-ix-category="internal" data-ix-label="Nigel video" data-id="2757409367001"></a></div>
				<div class="vid-small link"><a href="#" class="ixtrack"  data-ix-category="internal" data-ix-label="Nadia video" data-id="2757389883001"></a></div>
				<div class="vid-small link"><a href="#"  class="ixtrack"  data-ix-category="internal" data-ix-label="Barbara video" data-id="2757409370001"></a></div>
			</div>
			<div class="cta">
				<a class="ixtrack" target="_blank" data-ix-category="external"  data-ix-label="Link to site" href="http://people.cathaypacific.com/people/en/home">
					<img src="img/cta.png" alt="Meet the team now" class="noflicker">
				</a>
			</div>
			<div class="logo"><img src="img/logo.png" width="368" alt="Cathay Pacific logo" class="noflicker"/></div>
		</div>
		<div class="video-container"></div>
		<a class="close ixtrack" data-ix-category="internal" data-ix-label="close video" >&#215;</a>
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
	<script id="ix-namer"
		data-ix-name="Cathay Pacific Tablet"
		src="http://ads.qz.com/js/qzad/qzad-1.0.js"
		type="text/javascript">
	</script>
	<script src="http://app.qz.com/js/frameMessager/QZIX.js" type="text/javascript"></script>
	<script src="http://app.qz.com/js/frameMessager/frameMessager.js" type="text/javascript"></script>
	<script type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>
	<script type="text/javascript">
		var timeouts = [];
		var currentVideo = '';
		var times=[3000, 1500, 5000];
		var currentFrame = 0;
		var imgs = [];
		var frames = [
			function () {
				$('#qzad').removeClass('preload');

				timeouts[0] = setTimeout(function() {
					$('#f1').fadeOut(2000);
				}, 750);
			},

			//frame 2
			function () {
				$('#f2').show();
				$('#f2 .upper').append(addThumbs()[0]);
				$('#f2 .bottom').append(addThumbs()[1]);
				setTimeout(function(){
					var d = 0, r =0;
					var xpos;
					$('.row div').each(function () {
						var that = $(this);						
						var upper = $(that).parent('.row').hasClass('upper');

						if(upper){				
						 	setTimeout(function(){
						 		xpos = that.width() * d;	
						 		that.css('left', xpos + 'px');
						 		d++;
						 	}, 150 * d);
							
						}else{
							setTimeout(function(){
						 		xpos = that.width() * r;
						 		that.css('left', xpos +'px');
						 		r++;
						 	}, 150 * d);
						}
					});
					$('#f3').show();
				}, 500);
					
			},

			//frame 3
			function () {	
				timeouts[1] = setTimeout(function() {
					$('.r1-3').addClass('anim');
					$('.r1-3').css({
						'overflow':'visible',
						'-webkit-transform':'translate(0px, 0px)',
						'-moz-transform':'translate(0px, 0px)',
						'transform':'translate(0px, 0px)'
					});

					timeouts[2] = setTimeout(function(){
						var image = new Image();
							image.src = 'img/f2-r1-thumb3-text.jpg';
							image.onload = function() {
								$('.r1-3 .thumb').addClass('noflicker');
								$('.r1-3 .thumb').attr('src', image.src);
							}
					}, 1100);
				}, 1000);			
			},

			//frame 4
			function () {
				timeouts[3] = setTimeout(function() {
					$('.f3').fadeOut(1000);
					$('.f2').fadeOut(900);
					$('#f4').fadeIn(1000);
				}, 500);
			}
		];

		function changeFrame () {
			if($.isFunction(frames[currentFrame])) {
				frames[currentFrame]();
				timeouts[4] = setTimeout(function(){
					currentFrame++;
					changeFrame();
				}, times[currentFrame]);
			}
		};
		// dynamically creates thumbnails for frame 2
		function addThumbs () {
			var string1 = '', string2 = '';

			for (i = 1; i <= 3; i++) {
				if(i<=3){
					string1+= '<div class="r1-'+i+' left"><img class="thumb noflicker" src="img/f2-r1-thumb'+i+'.jpg" /></div>';
					string2+= '<div class="r2-'+i+' left"><img class="thumb noflicker" src="img/f2-r2-thumb'+i+'.jpg" /></div>';
				}else{
					string1+= '<div class="r1-'+i+'"><img class="thumb noflicker" src="img/f2-r1-thumb'+i+'.jpg" /></div>';
					string2+= '<div class="r2-'+i+'"><img class="thumb noflicker" src="img/f2-r2-thumb'+i+'.jpg" /></div>';
				}
			};
			imgs[0] = string1;
			imgs[1] = string2;
			return imgs;
		};
		onTemplateLoad = function(experienceID){
			
			player = brightcove.api.getExperience(experienceID);
	        APIModules = brightcove.api.modules.APIModules;
		};
		onTemplateReady = function(){
		
			videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
			contentModule = player.getModule(APIModules.CONTENT);
			videoPlayer.loadVideoByID(currentVideo);
			videoPlayer.addEventListener(brightcove.api.events.MediaEvent.COMPLETE, mediaEventCompleteHandler);

			videoPlayer.getCurrentVideo(function(videoDTO) {
				if(videoDTO) {
					videoDTO.displayName = "";
					contentModule.updateMedia(videoDTO, function(newVideoDTO) {
						videoPlayer.play();
						$('.close').show().off().on('click', function(e){
							e.preventDefault();
							removePlayer();
							$(this).toggle();
						});
					});
				}
			});
		};
		mediaEventCompleteHandler = function(){
			$('.close').trigger('click');
		};
		removePlayer = function() {
			/* Remove the BC video player object, hide the container */
			$('#myExperience').remove();
			$('.video-container').empty().hide();
		};
		addPlayer = function(vid){
			return '<object id="myExperience" class="BrightcoveExperience">' +
				'<param name="bgcolor" value="#FFFFFF" />' +
				'<param name="width" value="" />' +
				'<param name="height" value="" />' +
				'<param name="playerID" value="1783580117001" />' +
				'<param name="playerKey" value="AQ~~,AAABnwxttEE~,HpQpfOmVc2uIuYoJ5Ua7iU_HbguYUAep" />' +
				'<param name="isVid" value="true" />' +
				'<param name="isUI" value="true" />' +
				'<param name="dynamicStreaming" value="true" />' +
				'<param name="includeAPI" value="true" />' +
				'<param name="templateLoadHandler" value="onTemplateLoad" />' +
				'<param name="templateReadyHandler" value="onTemplateReady" />' +
				'<param name="@videoPlayer" value="'+ vid +'" />' +
			'</object>';
		};
		startAd = function() {
			changeFrame();
			$('.link a').on('click',function(e){
				e.preventDefault();
				$('.video-container').show();

				currentVideo = $(e.currentTarget).data('id');
				$('.video-container').html(addPlayer(currentVideo));
				brightcove.createExperiences();

				$('.close').show();
				$('.close').off().on('click', function(e){
					e.preventDefault();
					$(this).toggle();
					removePlayer();
				});
			});
		};
		resetAd = function() {
			$('#qzad').addClass('preload');

			currentFrame = 0;
			
			$.each(timeouts, function(i, to) {
		    	clearTimeout(to);
		    });

			$('.frames').removeClass('off');
			$('#f2 .upper, #f2 .bottom').empty();
			$('#f2, #f3, #f4').hide();
			$('.r1-3').removeClass('anim');
			$('.f3 .copy').hide();
			$('.r1-3 .thumb').attr('src','http://ads.qz.com/sponsors/cathay_pacific/13-10-22/tablet/img/f2-r1-thumb3.jpg');
			$('#f1').show();
		};
		$(document).ready(function(){
			startAd();
		});
	</script>
</body>
</html>